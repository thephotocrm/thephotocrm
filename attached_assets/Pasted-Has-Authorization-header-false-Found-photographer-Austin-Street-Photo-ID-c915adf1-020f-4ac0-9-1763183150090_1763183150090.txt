Has Authorization header: false
âœ… Found photographer: Austin Street Photo (ID: c915adf1-020f-4ac0-951b-f726738447f2)
5:05:29 AM [express] GET /api/domain 304 in 210ms :: {"type":"client_portal","photographerSlug":"abbâ€¦
Origin: undefined
Host: thephotocrm.com
Token from cookie: photographer
Token exists: true
Auth source: photographer
Token payload: true
Authentication successful, continuing to route
5:05:22 AM [express] GET /api/inbox/unread-count 304 in 851ms :: {"unreadCount":0}
ğŸ“¥ INCOMING REQUEST: GET /api/domain
   Headers: undefined
ğŸŒ Domain detection: abbiestreet.tpcportal.co
ğŸ“¥ INCOMING REQUEST: POST /api/client-portal/request-magic-link
   Headers: "application/json"
ğŸŒ Domain detection: abbiestreet.tpcportal.co
  â†’ Client portal subdomain detected: abbiestreet
ğŸ” Looking up photographer by slug: abbiestreet for API route: /api/client-portal/request-magic-link
âœ… Found photographer: Austin Street Photo (ID: c915adf1-020f-4ac0-951b-f726738447f2)
ğŸ”— Magic link request received
  â†’ Domain: abbiestreet.tpcportal.co
  â†’ Email: austinpacholek2014@gmail.com
  â†’ Photographer ID: c915adf1-020f-4ac0-951b-f726738447f2
}
  â†’ Error stack: error: column "token_type" of relation "portal_tokens" does not exist
  length: 136,
  column: undefined,
  â†’ Found contact: 914e45bd-1909-410d-b767-e419938e16e0
  dataType: undefined,
âŒ Magic link request error: error: column "token_type" of relation "portal_tokens" does not exist
  position: '45',
  severity: 'ERROR',
  constraint: undefined,
  code: '42703',
  file: 'parse_target.c',
    at file:///app/node_modules/@neondatabase/serverless/index.mjs:1345:74
  line: '1066',
  internalPosition: undefined,
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
  routine: 'checkInsertTargets'
  detail: undefined,
  internalQuery: undefined,
    at async NeonPreparedQuery.execute (file:///app/node_modules/drizzle-orm/neon-serverless/session.js:76:20)
  where: undefined,
    at async DatabaseStorage.createPortalToken (file:///app/dist/index.js:2946:25)
  hint: undefined,
    at async file:///app/dist/index.js:13333:27 {
  schema: undefined,
  table: undefined,
    at file:///app/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async NeonPreparedQuery.execute (file:///app/node_modules/drizzle-orm/neon-serverless/session.js:76:20)
    at async DatabaseStorage.createPortalToken (file:///app/dist/index.js:2946:25)
    at async file:///app/dist/index.js:13333:27